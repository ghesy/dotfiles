#!/bin/sh
# an elaborated version of luke smith's screenshot script.
# requires maim and dmenu.
# it lets you choose the kind of screenshot to take,
# including copying the image or even highlighting an area to copy.
# scrotcucks on suicidewatch right now.

# config
dir=~/Documents/Screenshots
savemode='Save '
copymode='Copy '
mode=$savemode # initial mode (possible values: Save, Clipboard)
delay=0.2

while :; do
    fn="$(
        printf '%s\n' \
            "Mode = $mode" Fullscreen 'Select Area' 'Current Window' |
            dmenu -p Screenshot ${WINDOWID:+-w $WINDOWID}
    )" || exit 1
    case "$fn" in
        Mode*) [ "$mode" = "$savemode" ] && mode="$copymode" || mode="$savemode" ;;
        *) break ;;
    esac
done

mkdir -p "$dir" || dir=~
case $mode in
    "$savemode") a="$(date +"$dir"/%y%m%d-%H%M%S).png" ;;
    "$copymode") a="| xclip -selection clipboard -t image/png" ;;
esac

sleep $delay
case "$fn" in
    Full*) eval maim -u "$a" ;;
    Select*) eval maim -us "$a" ;;
    Current*) eval maim -ui $(xdotool getactivewindow) "$a" ;;
esac

[ $? -eq 0 ] && case "$mode" in
    "$savemode") notify-send -i "$a" 'Screenshot Saved.' ;;
    "$copymode") notify-send 'Screenshot Copied to Clipboard.' ;;
esac
