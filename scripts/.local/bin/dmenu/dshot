#!/bin/sh
# an elaborated version of luke smith's screenshot script.
# requires maim and dmenu.
# it lets you choose the kind of screenshot to take,
# including copying the image or even highlighting an area to copy.
# scrotcucks on suicidewatch right now.

# config
dir=/media/screenshots
mode=Save # initial mode (possible values: Save, Clipboard)
delay=0.2

while true; do
    fn="$(
        printf '%s\n' \
            "Mode = $mode" Fullscreen 'Select Area' 'Current Window' |
            dmenu -p Screenshot ${WINDOWID:+-w $WINDOWID}
    )"
    case "$fn" in
        Mode*) [ $mode = Save ] && mode=Clipboard || mode=Save ;;
        *) break ;;
    esac
done

mkdir -p "$dir" || dir=~
case $mode in
    Save)  a="$(date +"$dir"/%y%m%d-%H%M%S).png" ;;
    Clip*) a="| xclip -selection clipboard -t image/png" ;;
esac

# disable picom
case "$fn" in Full*) ;; *) usv down picom ;; esac

sleep $delay
case "$fn" in
    Full*) eval maim -u "$a" ;;
    Select*) eval maim -us "$a" ;;
    Current*) eval maim -ui $(xdotool getactivewindow) "$a" ;;
esac

[ $? -eq 0 ] && case "$mode" in
    Save) notify-send 'Screenshot Saved.' ;;
    Clip*) notify-send 'Screenshot Copied to Clipboard.' ;;
esac

# re-enable picom
case "$fn" in Full*) ;; *) usv up picom ;; esac
