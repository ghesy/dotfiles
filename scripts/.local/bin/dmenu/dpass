#!/bin/sh
dir=${PASSWORD_STORE_DIR:-$HOME/.password-store}
cd $dir || exit 1
f="$(find * -name '*.gpg' | rev | cut -c5- | rev |
        dmenu -p 'Wat password u want?' | xargs -rd'\n' pass show)"
prnt() { printf '%s\n' "$*" ;}
pass="$(prnt "$f" | head -n1)"
user="$(prnt "$f" | grep -Pio '^username:\s*\K.*')"
if [ -n "$user" ]; then
    notify-send -t 2000 -h string:x-dunst-stack-tag:dpass 'Username copied to clipboard.'
    prnt "$user" | timeout 45 xclip -r -quiet -loops 1 -selection clipboard || exit
fi
if [ -n "$pass" ]; then
    notify-send -t 2000 -u low -h string:x-dunst-stack-tag:dpass 'Password copied to clipboard.'
    prnt "$pass" | timeout 45 xclip -r -quiet -loops 1 -selection clipboard
fi
