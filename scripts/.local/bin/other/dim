#!/bin/sh
# dim the backlight, then restore
# the brightness upon getting killed.
# meant to be used as X's screensaver:
# $ xss-lock -n dim slock
# requires light(1).

# seconds before turning off the backlight completely
off_time=60

# sleep forever
pause() { while true; do sleep 1000000000; done }

# check wether changing the backlight is supported
command -v light >/dev/null || { echo "light" is not installed. >&2; pause ;}
light 2>&1 | grep -q found && { echo no backlight device found. >&2; pause ;}

# save current brightness
b=$(light)
b=${b%.*}

# restore brightness upon exit
trap exit HUP
trap "light -S $b" EXIT

# dim the backlight
light -S $((b/3))

# set the backlight to zero after the specified time
sleep $off_time
light -S 0

# sleep forever
pause
