#!/bin/sh
# with this script you can run arbitrary commands and programs using aliases.

# config
conf=~/.config/gimme
localconf=~/.local/share/local/gimme

main()
{
    source_functions
    case $1 in
        -l) list_aliases; return ;;
        -m) menu; return ;;
        '') return 1 ;;
    esac
    eval "$(get_cmd "$1")"
}

menu()
{
    # the -shb and -shf dmenu options require dmenu's fuzzyhighlight patch.
    a=$(list_aliases | dmenu -p 'Choose Your Poison:' -sb '#006000' \
        -shb '#006000' -sf white -shf green) || return 1
    eval "$(get_cmd "$a")"
}

list_aliases()
{
    get_entries | sed -e 's/[ \t]*:.*//g' -e 's/[ \t]*,[ \t]*/\n/g'
}

get_cmd()
{
    get_entries | grep -Pm1 "^(.*,[ \t]*)?\Q$1\E[ \t]*[,:]" | cut -d: -f2-
}

get_entries()
{
    for f in "$conf/aliases" "$localconf/aliases.d"/*; do
        [ -r "$f" ] && set -- "$@" "$f"
    done

    # handle line breaks and comments
    sed ':a;N;$!ba;s/\\\n//g' "$@" | awk 'NF && !/^#/'
}

source_functions()
{
    for f in "$conf/functions" "$localconf/functions.d"/*; do
        [ -r "$f" ] && . "$f"
    done
}

main "$@"
