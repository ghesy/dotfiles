#!/bin/sh
# this script puts all the tabs of the currently active firefox window
# into another firefox window that is in the same desktop or dwm tag.
# requires xdotool.

# note:
# your window manager needs to support the _NET_WM_DESKTOP hint.
# if you use dwm, you need to apply this patch: https://github.com/soystemd/dwm/compare/cc4564f...5ce1409
# sidenote - the above patch is based on this patch: https://github.com/wor/abs-repo/blob/master/dwm-git/dwm-6.1-netwmdesktop.patch

# config
class=firefox

set -e
ff1=$(xdotool getactivewindow) || exit 1
[ "$(xdotool getwindowclassname "$ff1")" != "${class:?}" ] && exit 2
ff2=$(xdotool search --desktop $(xdotool get_desktop) --class "${class:?}" | grep -Fvm1 "$ff1") || exit 3
geom=$(xdotool getwindowgeometry --shell "$ff2") && eval "$geom" || exit 4

s='sleep 0.1'
d='--delay 100'
c=--clearmodifiers
timeout 5 xdotool mousemove --window "$ff1" 50 10 \
    key $c $d ctrl+shift+Tab ctrl+Tab \
    click $c 3 \
    key $c $d s Escape \
    mousedown $c 1 \
    mousemove $((X+WIDTH-100)) $((Y+20)) $s \
    mousemove_relative -- -5 0 $s \
    mouseup $c 1 $s \
    mousemove 0 0 $s \
    mousemove --window "$ff2" --polar 0 0 \
    windowactivate --sync "$ff2" $s \
    key $c $d ctrl+shift+Tab ctrl+Tab

xdotool keyup Shift_L Shift_R Control_L Control_R
