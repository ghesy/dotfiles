#!/bin/bash
# download videos using yt-dlp and aria2.

[ -f "${1:?}" ] && exit 1
cd /media/downloads || cd ~/Downloads || cd ~ || exit 1
res=$(printf '480\n720\n1080\n360\n' | dmenu -p Resolution: ${WINDOWID:+-w $WINDOWID}) || exit 1

$(getproxy "${1:?}") yt-dlp -S "+res:$res,abr~$((res/5))" -N 8 --add-metadata \
    --no-mtime --sub-lang=en --write-sub --write-auto-sub --embed-subs  \
    --compat-options no-keep-subs --downloader aria2c --downloader-args \
    aria2c:'-c -k1M -x8 -s8 --async-dns=false' -- "${@#ytdl://*}"

case $? in
    0) echo Download finished.
        read x
        exec $SHELL ;;
    *) echo Download failed.
        read x
        exit ;;
esac
