#!/bin/sh
# pause whatever is playing upon headphone jack disconnection.
# requires the JACKPORT environment variable to be set to the name of your headphone port.

get_current_port() {
    pacmd list-sinks |
        awk -F'<|>' '/ +\* +index/ {a=1} a && /active port:/ {print $2; exit}'
}

[ -z "$JACKPORT" ] && return 1
p=$(get_current_port) || return 1

trap exit HUP
trap 'pkill -P $$' EXIT

pactl subscribe | grep --line-buffered card |
    while IFS= read -r line; do
        n=$(get_current_port)
        [ $p = $JACKPORT ] && [ $n != $p ] && toggleall pause
        p=$n
    done
