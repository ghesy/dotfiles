#!/bin/bash
# update my dotfiles, my syncthing-synced files and my suckless software repoes.
set -eE
trap 'echo failed at line $LINENO: $BASH_COMMAND' ERR

pushd /media/syncthing/Main
    ./install.sh
popd

pushd ~/.dots
    if git branch --show | grep -q master; then
        git pull | grep -v '^Already up to date' &&
        echo y | ./install.sh && echo
    else
        echo dotfiles is not on the proper branch
    fi
popd

for dir in ~/Repositories/suckless/*/; do
    pushd "$dir"
        if git branch --show | grep -q ^my-; then
            git pull | grep -v '^Already up to date' && make && sudo make install
        else
            echo "$(basename "$dir") is not on the proper branch"
        fi
    popd
done
