#!/bin/sh
# hibernate using susbernate if hibernating is supported,
# suspend to memory otherwise.

# config
locker=slock

main()
{
    if can_hibernate; then
        suspend_then_hibernate
    else
        suspend
    fi
    dwmbarref battery
}

suspend_then_hibernate()
{
    if have susbernate; then
        sudo -A susbernate -h >/dev/null 2>&1
        setsid -f $locker
        sudo -A susbernate
    elif have loginctl; then
        loginctl suspend-then-hibernate
    elif have systemctl; then
        systemctl suspend-then-hibernate
    fi
}

suspend()
{
    if have zzz; then
        sudo -A zzz
        setsid -f $locker
    elif have loginctl; then
        loginctl suspend
    elif have systemctl; then
        systemctl suspend
    fi
}

can_hibernate() { grep -q 'resume=' /proc/cmdline ;}
have() { command -v "$1" >/dev/null ;}

main "$@"
exit
