#!/bin/sh
# bookmark paths.
# requires moreutils.

# config
list=~/.local/share/bm/bookmarks

main ()
{
    fn=resolve
    while getopts arlm opt; do
        case $opt in
            a) fn=add ;;
            r) fn=remove ;;
            l) fn=list ;;
            m) fn=menu ;;
            ?) exit 1 ;;
        esac
    done
    shift $((OPTIND-1))

    [ -z "$*" ] && set -- "$(basename "$PWD")"

    for bm; do
        bm="$(printf '%s\n' "$bm" | tr ' \t' '_')"
        $fn
    done
}

menu()
{
    bm="$(list | dmenu -p 'Go Where?')" || return 1
    xdg-open "$(resolve)"
}

list()
{
    awk '{print $1}' "$list"
}

add()
{
    remove
    mkdir -p "$(dirname "$list")"
    printf '%s\n%s\t%s\n' "$(cat "$list")" "$bm" "$PWD" | column -t | sponge "$list"
}

remove()
{
    awk -v bm="$bm" 'tolower($1) != tolower(bm)' "$list" | sponge "$list"
}

resolve()
{
    awk -v bm="$bm" 'tolower($1) == tolower(bm) {print $2}' "$list"
}

main "$@"
