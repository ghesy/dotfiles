#!/bin/sh
# toggle the currently playing players.

# file to save the playing players in
state="${XDG_RUNTIME_DIR:-/tmp}/toggleall"

main()
{
    case "$1" in
        restore) restore ;;
        pause) pause ;;
        *) toggle ;;
    esac
}

pause()
{
    get_players > "$state"
    mpc pause >/dev/null &
    playerctl -a pause &
    wait
    return 0
}

restore()
{
    [ ! -r "$state" ] && return 1
    xargs -a "$state" -L1 playerctl play -p
    rm -f "$state"
}

toggle()
{
    [ -s "$state" ] && restore || pause
}

get_players()
{
    playerctl -a status -f '{{playerInstance}}	{{lc(status)}}' 2>/dev/null |
        grep playing | cut -f1
}

main "$@"
