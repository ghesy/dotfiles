#!/bin/sh
# toggle the currently playing players.

# file to save the playing players in
state="${XDG_RUNTIME_DIR:-/tmp}/toggleall"
mpd="${XDG_RUNTIME_DIR:-/tmp}/toggleall-mpc"

main()
{
    case "$1" in
        restore) restore ;;
        pause) pause ;;
        *) toggle ;;
    esac
}

pause()
{
    (get_players > "$state"; playerctl -a pause) &
    mpc | grep -q '^\[playing' && :>"$mpd"
    mpc pause >/dev/null
    wait
    return 0
}

restore()
{
    if [ -r "$state" ]; then
        xargs -ra "$state" -L1 playerctl play -p
        rm -f "$state"
    fi
    if [ -r "$mpd" ]; then
        mpc play >/dev/null
        rm -f "$mpd"
    fi
    return 0
}

toggle()
{
    [ -r "$state" ] && restore || pause
}

get_players()
{
    playerctl -a status -f '{{playerInstance}}	{{lc(status)}}' 2>/dev/null |
        grep playing | cut -f1
}

main "$@"
