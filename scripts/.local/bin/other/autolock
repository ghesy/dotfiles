#!/bin/sh
# toggle and change auto locking via xset.
# it only works if auto locking was already enabled via xset.
# it works by saving the current xset values to use them later.

# config
save="${XDG_RUNTIME_DIR:-/tmp}/tautolock-save"

main()
{
    case "$1" in
        off|no) off ;;
        on|yes) on ;;
        *) toggle ;;
    esac
}

toggle()
{
    if is_autolock_on; then
        off
    else
        on
    fi
}

off()
{
    is_autolock_on || return
    xset q | grep timeout: | grep -Eo '\b[0-9]+\b' | tr '\n' ' ' > "$save"
    xset s off off
}

on()
{
    is_autolock_on && return
    [ -r "$save" ] || return
    xset s $(cat "$save")
}

is_autolock_on()
{
    xset q | grep timeout: | grep -o '[0-9]' | grep -qv 0
}

main "$@"
exit
