# don't set the to anything other than bash
set shell bash
set shellopts '-u'
set ifs "\n"
set mouse
set scrolloff 10
set nopreview
set period 1
set ratios 1
set dircounts
set previewer lfpreviewer
set cleaner   lfcleaner
set timefmt   "2006-01-02 15:04"
set errorfmt  "\033[31m%s\033[0m"
set promptfmt "\033[2m%d"
set hiddenfiles ".*:$RECYCLE.BIN:System Volume Information"

cmd open &~/.config/lf/opener
cmd openall &~/.config/lf/opener -a

cmd paste ${{
    printf '\e[?1049h'
    printf '\e[H'
    list=~/.local/share/lf/files
    mode=$(head -n1 $list)
    srcs=$(sed 1d $list)
    tput civis
    case $mode in
        copy) cpg -ag --backup=numbered $srcs . ;;
        move) mvg  -g --backup=numbered $srcs . 2>/dev/null ;;
    esac
    e=$?
    tput cnorm
    [ $e -ne 0 ]  exit
    rm $list
    lf -remote 'send clear'
}}

cmd delete ${{
    printf '\e[?1049h'
    printf '\e[H'
    echo 'Permanently Deleting Files:'; echo
    printf '  %s\n' $fx ""
    read -p 'Delete? [y/N] ' ans
    case "$ans" in y|Y) rm -rf -- $fx ;; esac
}}

cmd mkdir %{{
    printf ' '
    read dir
    mkdir -p $dir
    lf -remote "send load"
    printf '%s\n' $dir | lfselect
}}

cmd finder ${{
    f=$(finder -f) || exit
    case $(basename -- $f) in
        .*) lf -remote "send $id set hidden" ;;
    esac
    printf '%s\n' $f | lfselect
}}

cmd q quit
cmd preview-on push :set<space>ratios<space>1:1;set<space>preview;<space>load<enter>
cmd preview-off push :set<space>nopreview;set<space>ratios<space>1;<space>&lfcleaner<enter>
cmd trash push &trash-put<space>$fx;lf<space>-remote<space>"send<space>load"
cmd bulkrename $realpath -s --relative-base=$PWD -- $fx | vidir -
cmd archive $apack $1 $fx

map ~ cd ~
map . set hidden!
map * push :glob-select<space>
map gh
map g top
map L openall
map E $aunpack -De -- $fx
map X push :archive<space>
map P $compress $fx
map t preview-on
map T preview-off
map U &termopen
map D trash
map x !$f
map <c-n> mkdir
map <c-f> finder
map B bulkrename
map b &wallpaper $f
map V push $$EDITOR<space>
map R &dragon-drag-and-drop -a -x $fx
map S %echo " calculating... "; du -sh 2>/dev/null # get size of dir
map Y &printf %s $f | xclip -selection clipboard # copy file's path
map o &readlink -f $f | lfselect # follow symlinks
map H push :mark-load<enter>' # jump back to previous dir
map K push hkl # go to the previous parent dir
map J push hjl # go to the next parent dir

# renaming
map A rename # at the very end
map I push A<c-a> # at the very beginning
map C push A<c-u> # new rename

map m
map "'"
map '"'

# avoid 'unknown mapping' error
map <esc> :echo
map <tab> :echo

# mouse
map <m-down> down
map <m-up> up
map <m-1> preview-on
map <m-2> preview-off
