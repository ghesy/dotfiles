# vim:ft=zsh

# add all of ~/.local/bin's immediate subdirectories to PATH.
localpaths="$(find ~/.local/bin -mindepth 1 -maxdepth 1 -printf ":%p")"
export PATH="${PATH}${localpaths}"

# default programs
export TERMINAL=st
export EDITOR=nvim
export VISUAL=nvim
export BROWSER=firefox
export OPENER=opener
export TFM=lfrun

# xdg dirs
export XDG_STATE_HOME=~/.local/state
export XDG_DATA_HOME=~/.local/share
export XDG_CONFIG_HOME=~/.config
export XDG_CACHE_HOME=~/.cache

# home clean-up
source ~/.config/zsh/xdg

# have sudo ask for a password via dmenu
export SUDO_ASKPASS=~/.local/bin/dmenu/dmenu-askpass

# stuff used in my scripts
export USVDIR=~/.local/sv/run # user services
export ARIA2_CONF=~/.config/aria2/server.conf

# tuir settings
export TUIR_BROWSER=pipeurl
export TUIR_URLVIEWER=pipeurl

# bat theme
export BAT_THEME=Nord
export LF_BAT_OPTS='-p'
export LF_IMG_REGEX='.*\.(jpe?g|png|gif|bmp|ico|svg|webp)$'

# less colors
export LESS='-RSmci'
export LESSHISTFILE=- # disable less's history
export LESS_TERMCAP_so=$'\E[01;44;33m' # begin reverse video
export LESS_TERMCAP_us=$'\E[1;32m' # begin underline
export LESS_TERMCAP_mb=$'\E[1;31m' # begin blink
export LESS_TERMCAP_md=$'\E[1;36m' # begin bold
export LESS_TERMCAP_me=$'\E[0m' # reset bold/blink
export LESS_TERMCAP_se=$'\E[0m' # reset reverse video
export LESS_TERMCAP_ue=$'\E[0m' # reset underline
export LESSOPEN='| bat -fppn -- %s 2>/dev/null' # colorize less using bat

# ls settings
ls_colors=~/.config/lscolors/lscolors
[ -r "$ls_colors" ] && source "$ls_colors"
export TIME_STYLE='+%F %T'

# other stuff
export MPD_HOST=localhost
export MOZ_USE_XINPUT2=1 # Mozilla smooth scrolling/touchpads.
export _JAVA_AWT_WM_NONREPARENTING=1 # fix for java applications in dwm

# fzf settings
export FZF_DEFAULT_OPTS='
--layout=reverse --height=40%
--bind=ctrl-d:half-page-down,ctrl-u:half-page-up,ctrl-g:top
--color=dark
--color=fg:244,bg:-1,hl:#a07f32,fg+:#dedede,bg+:-1,hl+:#fabd2f
--color=info:#83a598,prompt:#bdae93,spinner:#fabd2f
--color=pointer:#83a598,marker:#fe8019,header:#665c54
'

# set qt style to qt5ct if it's installed, otherwise set to gtk2
command -v qt5ct >/dev/null && qtenv=qt5ct || qtenv=gtk2
export QT_QPA_PLATFORMTHEME="$qtenv"

# run keychain (an ssh-agent manager)
keychain --dir "$KEYCHAIN_DIR" >/dev/null 2>&1
source "$KEYCHAIN_DIR/$(uname -n)-sh"

# set machine's chassis type
case $(</sys/class/dmi/id/chassis_type) in
    9|10|11|14) export CHASSIS=laptop  ;;
             *) export CHASSIS=desktop ;;
esac

# load machine-specific configs
for f in $(find ~/.local/share/local/profile.d -type f 2>/dev/null); do
    source "$f"
done

# start X if we're on tty1
if [ -z "$DISPLAY" ] && [ "$(tty)" = "/dev/tty1" ]; then
    [ -z "$SSH_CLIENT" ] && trap reset EXIT
    startx "$XINITRC" >/dev/null 2>&1
fi
